<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Yuung Offline Player â€“ Simple</title>
<style>
  body { font-family: sans-serif; background:#e6f9ff; margin:0; padding:20px; }
  h1 { margin:0 0 10px 0; }
  #list { margin-top:20px; }
  .item { background:white; padding:10px; margin-bottom:8px; border-radius:8px; }
  .controls button { margin-right:10px; }
  .now { margin-top:20px; padding:10px; background:white; border-radius:8px; }
</style>
</head>
<body>

<h1>ğŸ§ Yuung Offline Player (Simple Version)</h1>
<p>PhiÃªn báº£n cháº¡y 100% trÃªn PC â€” chá»‰ cáº§n má»Ÿ file lÃ  dÃ¹ng Ä‘Æ°á»£c.</p>

<input type="file" id="files" accept="audio/*" multiple>
<button id="shuffleBtn">ğŸ”€ Shuffle</button>

<div id="list"></div>

<div class="now">
  <b>Äang phÃ¡t:</b> <span id="nowTitle">â€”</span><br>
  <div class="controls">
    <button id="prevBtn">â® Prev</button>
    <button id="playBtn">â–¶ï¸ Play</button>
    <button id="nextBtn">â­ Next</button>
  </div>
  <input id="seek" type="range" min="0" max="100" value="0" style="width:250px;">
</div>

<script>
let audio = new Audio();
let tracks = [];
let queue = [];
let currentIndex = -1;
let shuffle = false;

function formatTime(t){
  const m = Math.floor(t / 60);
  const s = Math.floor(t % 60).toString().padStart(2,'0');
  return `${m}:${s}`;
}

document.getElementById("files").addEventListener("change", (e) => {
  const files = [...e.target.files];
  tracks = files.map((f, i) => ({ id:i, file:f, url:URL.createObjectURL(f) }));
  queue = tracks.map(t => t.id);
  renderList();
});

function renderList(){
  const list = document.getElementById("list");
  list.innerHTML = "";
  tracks.forEach(t => {
    const div = document.createElement("div");
    div.className = "item";
    div.textContent = "ğŸµ " + t.file.name;
    div.onclick = () => playById(t.id);
    list.appendChild(div);
  });
}

function playById(id){
  currentIndex = queue.indexOf(id);
  const t = tracks.find(x => x.id === id);
  if(!t) return;
  audio.src = t.url;
  audio.play();
  document.getElementById("nowTitle").textContent = t.file.name;
  document.getElementById("playBtn").textContent = "â¸ Pause";
}

document.getElementById("playBtn").onclick = () => {
  if(audio.paused){ audio.play(); document.getElementById("playBtn").textContent="â¸ Pause"; }
  else { audio.pause(); document.getElementById("playBtn").textContent="â–¶ï¸ Play"; }
};

document.getElementById("nextBtn").onclick = () => {
  if(currentIndex < queue.length - 1) currentIndex++;
  playById(queue[currentIndex]);
};

document.getElementById("prevBtn").onclick = () => {
  if(currentIndex > 0) currentIndex--;
  playById(queue[currentIndex]);
};

audio.addEventListener("timeupdate", () => {
  if(audio.duration){
    document.getElementById("seek").value = (audio.currentTime / audio.duration) * 100;
  }
});

document.getElementById("seek").oninput = (e) => {
  if(audio.duration){
    audio.currentTime = (e.target.value / 100) * audio.duration;
  }
};

document.getElementById("shuffleBtn").onclick = () => {
  shuffle = !shuffle;
  if(shuffle){
    queue = shuffleArray(tracks.map(t=>t.id));
    document.getElementById("shuffleBtn").textContent = "ğŸ”€ Shuffle ON";
  } else {
    queue = tracks.map(t=>t.id);
    document.getElementById("shuffleBtn").textContent = "ğŸ”€ Shuffle";
  }
};

function shuffleArray(a){
  const arr = [...a];
  for(let i=arr.length-1;i>0;i--){
    const j = Math.random()* (i+1) | 0;
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}
</script>

</body>
</html>
